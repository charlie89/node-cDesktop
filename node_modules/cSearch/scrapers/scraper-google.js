var scraper = require('scraper');
var events = require('events');

var Search = function () {
    if(false === (this instanceof Search)) {
        return new Search();
    }
    
    events.EventEmitter.call(this);
}

require('sys').inherits(Search, events.EventEmitter);

Search.prototype.startScraper = function(keyword){
   var self = this;
   
   scraper('http://www.google.com/search?ie=UTF-8&q=' + keyword, function(err, jQuery) {
      if (err) return;
      
      var web = [];
      jQuery('div#search li.g').each(function(num, value){
         web.push({
            caption : jQuery('h3.r:first a', value).text().replace('�', '-'),
            captionHTML: jQuery('h3.r:first a', value).html().replace('�', '-'),
            url    : jQuery('h3.r:first a', value).attr('href').match('[^/url?q=].*\/[&sa=]{0}'),
            description: jQuery('span.st', value).text().replace('�', '-')
         });         
      });
      self.emit('end', {type: 'google', value: web});
   });
};

module.exports = Search;